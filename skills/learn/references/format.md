# Learning Format Reference

## Scope Classification

| Scope | When to use | Destination root |
|---|---|---|
| `project` | Codebase-specific: errors, patterns, domain facts, workflows | `{origin_project_path}/` |
| `universal` | Agent-behavioral: mistakes, user preferences, tool quirks | `~/.claude/rules/` |

### Scope Decision

- If the learning only matters for ONE specific project → `project`
- If the learning applies across ALL projects → `universal`

## Type Classification

| Type | Scope | Default destination | Example |
|---|---|---|---|
| `error` | project | `{origin}/CLAUDE.md` > Error Patterns | "CORS middleware must be before auth" |
| `pattern` | project | `{origin}/CLAUDE.md` > Learned Patterns | "Inline glob hints at every reference" |
| `knowledge` | project | `{origin}/.claude/rules/{topic}.md` | "Events table uses soft deletes" |
| `workflow` | project | `{origin}/.claude/rules/{topic}.md` | "Deploy requires migrations first" |
| `agent-mistake` | universal | `~/.claude/rules/{topic}.md` | "Don't assume test failures mean code is wrong" |
| `user-preference` | universal | `~/.claude/rules/{topic}.md` | "Always run tests before committing" |
| `tool-behavior` | universal | `~/.claude/rules/{topic}.md` | "Anytype update-object cannot update body" |
| `skill-fix` | project | Full absolute path (see `routing.md` Group D) | Skill SKILL.md had wrong instructions |
| `script-fix` | project | Full absolute path (see `routing.md` Group D) | Hook script had a bug |
| `review-rule` | project | `{origin}/.claude/review-rules.md` | Recurring code review finding |

### Root Cause → Type Mapping

Correction Capture uses root causes. Digest Processing uses types. They map to each other:

| Correction Capture root cause | Digest Processing type | Notes |
|---|---|---|
| `claude-md` | `error` or `pattern` | error = something broke; pattern = a better way |
| `knowledge` | `knowledge` or `workflow` | knowledge = codebase fact; workflow = process/sequence |
| `skill` | `skill-fix` | |
| `script` | `script-fix` | |
| `general` | _(nothing written)_ | Agent reasoning error, no doc needed |
| `agent-mistake` | `agent-mistake` | Same in both |
| `user-preference` | `user-preference` | Same in both |
| `tool-behavior` | `tool-behavior` | Same in both |

### Title Format

Concise imperative statement (like a commit message).
- Good: "Use WAL mode for SQLite to prevent BUSY errors"
- Bad: "I found a bug with SQLite"

## unprocessed-corrections.md Format

Generated by the stop hook. The agent reads this file, classifies each correction, and routes it.

```markdown
# Unprocessed Session Corrections

**Action required:** Classify each learning by scope (project vs
universal) and destination (CLAUDE.md vs .claude/rules/). Check
existing rules files before writing — append to matching topic
files, never create duplicates. Route using the absolute project
path in each block header. Delete this file after processing.

---

## Session: abc123 | Project: /Users/ash/Desktop/myproject | 15 Feb 2026

A: [I'll use useState for the login component shared state.]
USER: No, that's wrong. We always use Zustand, never useState.

A: [Good point, switching to Zustand store.]
USER: Also remember the events table uses soft deletes.

---
```

### Block Header Fields

- **Session:** the session ID (filename without `.jsonl`)
- **Project:** absolute path to the project root (use this for routing)
- **Date:** when the session ended

### Message Format

- `USER:` — the correction or teaching moment
- `A: [...]` — preceding assistant message (truncated to 200 chars) for context
